(()=>{"use strict";const t=function(){let t=function(t){let e=[];for(let t=0;t<7;t++){e[t]=[];for(let a=0;a<7;a++)e[t][a]={ship:null,triedHit:!1}}return e}(),e=[];return{board:t,placeShip:function(a,r,n,o=!1){let i=[a,r];if(!1===o){a+n.length-1>=7&&(i=[7-n.length,r]);let o=i[0],s=i[1];for(let e=0;e<n.length;e++)if(t[o+e][s].ship)return!1;e.push(n);for(let e=0;e<n.length;e++)t[o+e][s].ship=n}else{r+n.length-1>=7&&(i=[a,7-n.length]);let o=i[0],s=i[1];for(let e=0;e<n.length;e++)if(t[s+e][o].ship)return!1;e.push(n);for(let e=0;e<n.length;e++)t[s+e][o].ship=n}return!0},shipsOnBoard:e,receiveAttack:function(t,e){let a=this.board[t][e];return!(!a||a.triedHit||(a.triedHit=!0,null!==a.ship&&a.ship.hit(),0))},allSunk:function(){return e.every((t=>t.isSunk()))}}},e=function(){const e=new t,a=function(t,e){return this.opp.gameboard.receiveAttack(t,e)},r=function(t){return Math.floor(Math.random()*t)},n=new Set,o=function(t=r){let e=t(7),i=t(7);if(!n.has(this.opp.gameboard.board[e][i]))return a.call(this,e,i),n.add(this.opp.gameboard.board[e][i]),[e,i];o.call(this,t)};return{gameboard:e,opp:null,attack:a,aiAttack:o}},a=function(t){return{length:t,hit:function(){0==this.isSunk()&&this.hits++},hits:0,isSunk:function(){return this.hits>=this.length}}},r=document.querySelector(".rotate"),n=(document.querySelector(".new-game"),document.querySelector(".user-board")),o=document.querySelector(".ai-board"),i=document.querySelector(".status"),s=function(){const t=new e,s=new e;t.opp=s,s.opp=t;let d=t;const l=[a(5),a(4),a(3)];let c=0,u=!1;const h=function(e){let a;a=e==t?document.querySelectorAll(".grid-square"):document.querySelectorAll(".ai-grid-square"),a.forEach((t=>{let a=e.gameboard.board[parseInt(t.dataset.x)][parseInt(t.dataset.y)];null!=a.ship?(t.classList.add("ship"),a.triedHit&&(t.classList.remove("ship"),t.classList.add("damaged"))):a.triedHit&&t.classList.add("miss")}))},g=function(e){i.textContent=e===t?"You won!":"You lost!"},p=function(e){let a=l[c].length;const r=document.querySelectorAll(".grid-square");let n=parseInt(e.target.dataset.x),o=parseInt(e.target.dataset.y),i=[n,o];if(!1===u){n+a-1>=7&&(i=[7-a,o]);let s=i[0],d=i[1];for(let r=0;r<a;r++)if(t.gameboard.board[s+r][d].ship)return e.target.classList.add("invalid"),void e.target.addEventListener("mouseout",(()=>{e.target.classList.remove("invalid")}));let l=new Set;for(let t=0;t<a;t++)r.forEach((a=>{a.dataset.x===s+t+""&&a.dataset.y===d+""&&(a.classList.add("placeable"),l.add(a)),e.target.addEventListener("mouseout",(()=>{l.forEach((t=>{l.delete(t),t.classList.remove("placeable")}))}))}));return}o+a-1>=7&&(i=[n,7-a]);let s=i[0],d=i[1];for(let r=0;r<a;r++)if(t.gameboard.board[d+r][s].ship)return e.target.classList.add("invalid"),void e.target.addEventListener("mouseout",(()=>{e.target.classList.remove("invalid")}));let h=new Set;for(let t=0;t<a;t++)r.forEach((a=>{a.dataset.x===startingX&&a.dataset.y===startingY+t&&h.add(a),e.target.addEventListener("mouseout",(()=>{h.forEach((t=>{h.delete(t),t.classList.remove("placeable")}))}))}))},m=function(e){if(e.target.classList.contains("invalid"))return;let a=l[c];t.gameboard.placeShip(parseInt(e.target.dataset.x),parseInt(e.target.dataset.y),a,!1),h(t),c++,c>l.length&&(document.querySelectorAll(".grid-square").forEach((t=>{t.removeEventListener("mouseover",p),t.removeEventListener("click",m)})),r.style.visiblity="hidden",f())},f=function(){i.textContent="Strike the enemy!",function(e,a=!0){const r=e.opp,n=r==t?".grid-square":".ai-grid-square";document.querySelectorAll(n).forEach((n=>{n.addEventListener("click",(()=>{if(d===r)return;let o=e.attack(parseInt(n.dataset.x),parseInt(n.dataset.y));o&&null!==r.gameboard.board[parseInt(n.dataset.x)][parseInt(n.dataset.y)].ship?(i.textContent="Ship hit!",r.gameboard.allSunk()&&(i.textContent="You win!",g(t))):i.textContent=o?"Miss!":"Already hit, try again",h(r),!0===o&&(d=r,!0===a&&d!=t&&(s.aiAttack(),h(t),t.gameboard.allSunk()&&(i.textContent="Computer Wins!",g(s)),d=t))}))}))}(t)};return{createUserBoard:function(){for(let e=0;e<t.gameboard.board.length;e++)for(let a=0;a<t.gameboard.board[e].length;a++){const t=document.createElement("div");t.classList.add("grid-square"),t.dataset.x=a,t.dataset.y=e,t.textContent=`${a}, ${e}`,n.appendChild(t)}},createAiBoard:function(){for(let t=0;t<s.gameboard.board.length;t++)for(let e=0;e<s.gameboard.board[t].length;e++){const a=document.createElement("div");a.classList.add("ai-grid-square"),a.dataset.x=e,a.dataset.y=t,a.textContent=`${e}, ${t}`,o.appendChild(a)}},startGame:function(){r.addEventListener("click",(()=>{u=!u})),i.textContent=`Place your ${l[c].length} length ship`,function(){const t=new a(3),e=new a(4),r=new a(5);s.gameboard.placeShip(0,0,t),s.gameboard.placeShip(2,4,e),s.gameboard.placeShip(5,0,r,!0),h(s)}(),document.querySelectorAll(".grid-square").forEach((t=>{t.addEventListener("mouseover",p),t.addEventListener("click",m)}))}}}(),d=document.querySelector(".new-game");s.createAiBoard(),s.createUserBoard(),d.addEventListener("click",(()=>{d.textContent="New Game",s.startGame()}))})();