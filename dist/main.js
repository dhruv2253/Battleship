(()=>{"use strict";const t=function(){let e=function(e){let t=[];for(let e=0;e<7;e++){t[e]=[];for(let a=0;a<7;a++)t[e][a]={ship:null,triedHit:!1}}return t}(),t=[];return{board:e,placeShip:function(a,r,n,i=!1){let s=[a,r];if(!1===i){a+n.length-1>=7&&(s=[7-n.length,r]);let i=s[0],o=s[1];for(let t=0;t<n.length;t++)if(e[i+t][o].ship)return!1;t.push(n);for(let t=0;t<n.length;t++)e[i+t][o].ship=n}else{r+n.length-1>=7&&(s=[a,7-n.length]);let i=s[0],o=s[1];for(let t=0;t<n.length;t++)if(e[o+t][i].ship)return!1;t.push(n);for(let t=0;t<n.length;t++)e[o+t][i].ship=n}return!0},shipsOnBoard:t,receiveAttack:function(e,t){let a=this.board[e][t];return!(!a||a.triedHit||(a.triedHit=!0,null!==a.ship&&a.ship.hit(),0))},allSunk:function(){return t.every((e=>e.isSunk()))}}},a=function(){const e=new t,a=function(e,t){return this.opp.gameboard.receiveAttack(e,t)},r=function(e){return Math.floor(Math.random()*e)},n=new Set,i=function(e=r){let t=e(7),s=e(7);if(!n.has(this.opp.gameboard.board[t][s]))return a.call(this,t,s),n.add(this.opp.gameboard.board[t][s]),[t,s];i.call(this,e)};return{gameboard:e,opp:null,attack:a,aiAttack:i}},r=function(e){return{length:e,hit:function(){0==this.isSunk()&&this.hits++},hits:0,isSunk:function(){return this.hits>=this.length}}},n=document.querySelector(".rotate"),i=(document.querySelector(".new-game"),document.querySelector(".user-board")),s=document.querySelector(".ai-board");document.querySelector(".status"),function(){const t=new a,o=new a;t.opp=o,o.opp=t;const d=[r(5),r(4),r(3)];let l=0;const c=function(){for(let e=0;e<t.gameboard.board.length;e++)for(let a=0;a<t.gameboard.board[e].length;a++){const t=document.createElement("div");t.classList.add("grid-square"),t.dataset.x=a,t.dataset.y=e,t.textContent=`${a}, ${e}`,i.appendChild(t)}},u=function(){for(let e=0;e<o.gameboard.board.length;e++)for(let t=0;t<o.gameboard.board[e].length;t++){const a=document.createElement("div");a.classList.add("ai-grid-square"),a.dataset.x=t,a.dataset.y=e,a.textContent=`${t}, ${e}`,s.appendChild(a)}},h=function(e){let a;a=e==t?document.querySelectorAll(".grid-square"):document.querySelectorAll(".ai-grid-square"),a.forEach((t=>{let a=e.gameboard.board[parseInt(t.dataset.x)][parseInt(t.dataset.y)];null!=a.ship?(t.classList.add("ship"),a.triedHit&&(t.classList.remove("ship"),t.classList.add("damaged"))):a.triedHit&&t.classList.add("miss")}))},g=function(e){let a=d[l].length;const r=document.querySelectorAll(".grid-square");let n=parseInt(e.target.dataset.x),i=parseInt(e.target.dataset.y),s=[n,i];if(!1===vertical){n+a-1>=7&&(s=[7-a,i]);let o=s[0],d=s[1];for(let r=0;r<a;r++)if(t.gameboard.board[o+r][d].ship)return e.target.classList.add("invalid"),void e.target.addEventListener("mouseout",(()=>{e.target.classList.remove("invalid")}));let l=new Set;for(let t=0;t<a;t++)r.forEach((t=>{t.dataset.x===startingX&&t.dataset.y===startingY&&l.add(t),e.target.addEventListener("mouseout",(()=>{l.forEach((e=>{l.delete(e),e.classList.remove("placeable")}))}))}));return}i+a-1>=7&&(s=[n,7-a]);let o=s[0],c=s[1];for(let r=0;r<a;r++)if(t.gameboard.board[c+r][o].ship)return e.target.classList.add("invalid"),void e.target.addEventListener("mouseout",(()=>{e.target.classList.remove("invalid")}));let u=new Set;for(let t=0;t<a;t++)r.forEach((t=>{t.dataset.x===startingX&&t.dataset.y===startingY&&u.add(t),e.target.addEventListener("mouseout",(()=>{u.forEach((e=>{u.delete(e),e.classList.remove("placeable")}))}))}))},p=function(){if(e.target.classList.contains("invalid"))return;let a=d[l];t.gameboard.placeShip(parseInt(e.target.dataset.x),parseInt(e.target.dataset.y),a,!1),h(t),l++,l>d.length&&(document.querySelectorAll(".grid-square").forEach((e=>{e.removeEventListener("mouseover",g),e.removeEventListener("click",p)})),n.style.visiblity="hidden",f())},f=function(){c(),u(),document.querySelectorAll(".grid-square").forEach((e=>{e.addEventListener("mouseover",g),e.addEventListener("click",p)}))};return{createUserBoard:c,createAiBoard:u,renderShips:h,placeAiShips:function(){const e=new r(3),t=new r(4),a=new r(5);o.gameboard.placeShip(0,0,e),o.gameboard.placeShip(2,4,t),o.gameboard.placeShip(5,0,a,!0),h(o)},startGame:f}}().startGame()})();